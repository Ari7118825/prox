<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scramjet Request Sniffer</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen">

    <div class="p-4 bg-black border-b border-green-500">
        <h1 class="text-green-500 font-mono text-xl">NETWORK SNIFFER ACTIVE</h1>
        <p class="text-xs text-gray-400">Target: https://yumiscramjetafc02c3096bf.share.zrok.io/</p>
    </div>

    <div class="flex flex-1 overflow-hidden">
        
        <div class="w-2/3 h-full bg-white">
            <iframe id="scramjetFrame" 
                    src="https://yumiscramjetafc02c3096bf.share.zrok.io/" 
                    class="w-full h-full border-none"></iframe>
        </div>

        <div class="w-1/3 h-full bg-black border-l border-gray-800 flex flex-col">
            <div class="p-2 bg-gray-900 text-xs font-bold uppercase tracking-widest text-gray-500">Outgoing API Requests</div>
            <div id="requestLog" class="flex-1 overflow-y-auto p-2 font-mono text-[10px] space-y-2">
                <div class="text-blue-400 italic">Waiting for iframe activity...</div>
            </div>
            <div class="p-4 border-t border-gray-800">
                <button onclick="extractAPI()" class="w-full bg-green-600 py-2 text-black font-bold rounded">FIND API BASE URL</button>
            </div>
        </div>
    </div>

    <script>
        const log = document.getElementById('requestLog');
        const frame = document.getElementById('scramjetFrame');

        // This function attempts to "Reach into" the iframe to wrap its fetch
        // NOTE: This only works if CORS is enabled on your server!
        function startSniffing() {
            try {
                const iframeWin = frame.contentWindow;
                
                // Intercept Fetch inside the iframe
                const oldFetch = iframeWin.fetch;
                iframeWin.fetch = function(...args) {
                    const url = args[0];
                    addLog(`FETCH: ${url}`);
                    return oldFetch.apply(this, args);
                };

                // Intercept XHR (older API calls)
                const oldOpen = iframeWin.XMLHttpRequest.prototype.open;
                iframeWin.XMLHttpRequest.prototype.open = function(method, url) {
                    addLog(`XHR [${method}]: ${url}`);
                    return oldOpen.apply(this, arguments);
                };

                addLog("Sniffer attached successfully.", "success");
            } catch (e) {
                addLog("CORS BLOCKED: Browser prevented sniffing. See fix below.", "error");
            }
        }

        function addLog(msg, type = 'info') {
            const entry = document.createElement('div');
            entry.className = type === 'error' ? 'text-red-500' : (type === 'success' ? 'text-green-400' : 'text-gray-300');
            entry.innerHTML = `<span class="text-gray-600">[${new Date().toLocaleTimeString()}]</span> ${msg}`;
            log.prepend(entry);
        }

        function extractAPI() {
            const entries = Array.from(log.querySelectorAll('div')).map(d => d.innerText);
            const apiMatch = entries.find(e => e.includes('/api/v'));
            if (apiMatch) {
                alert("Found Potential API: " + apiMatch.split(' ')[2]);
            } else {
                alert("No API path detected yet. Interact with the UI inside the iframe!");
            }
        }

        frame.onload = startSniffing;
    </script>
</body>
</html>
