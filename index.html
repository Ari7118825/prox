<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scramjet Direct DOM Sniffer</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-gray-200 flex h-screen overflow-hidden">

    <div class="w-96 bg-zinc-900 border-r border-zinc-700 flex flex-col shadow-xl z-50">
        <div class="p-4 bg-zinc-800 border-b border-zinc-700">
            <h2 class="text-green-400 font-bold uppercase text-xs tracking-widest">Live Traffic Monitor</h2>
        </div>
        <div id="traffic-logs" class="flex-1 overflow-y-auto p-2 font-mono text-[10px] space-y-1">
            <div class="text-gray-500 italic">Waiting for Scramjet to load...</div>
        </div>
    </div>

    <div class="flex-1 relative overflow-auto bg-white" id="scramjet-viewport">
        </div>

    <script>
        const TARGET_URL = 'https://yumiscramjetafc02c3096bf.share.zrok.io/';
        const logBox = document.getElementById('traffic-logs');

        // 1. GLOBAL INTERCEPTOR
        // We catch all traffic before it leaves the browser
        const { fetch: originalFetch } = window;
        window.fetch = async (...args) => {
            const url = args[0];
            const logEntry = document.createElement('div');
            logEntry.className = "p-1 bg-zinc-800 border-l border-blue-500 mb-1 break-all";
            logEntry.innerHTML = `<span class="text-blue-400">[REQ]</span> ${url}`;
            logBox.prepend(logEntry);

            return originalFetch.apply(window, args);
        };

        // 2. DIRECT DOM INJECTOR
        async function injectWebsite() {
            try {
                // Fetching the raw website content directly
                const response = await originalFetch(TARGET_URL);
                const htmlText = await response.text();

                const viewport = document.getElementById('scramjet-viewport');
                
                // Fix relative paths (CSS/JS) by setting the BASE tag
                const baseTag = document.createElement('base');
                baseTag.href = TARGET_URL;
                document.head.appendChild(baseTag);

                // Inject the HTML string into the viewport
                viewport.innerHTML = htmlText;

                // Re-trigger script execution
                // Simply setting innerHTML doesn't run <script> tags
                const scripts = Array.from(viewport.querySelectorAll('script'));
                for (const oldScript of scripts) {
                    const newScript = document.createElement('script');
                    Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                    
                    if (oldScript.src) {
                        newScript.src = oldScript.src;
                    } else {
                        newScript.textContent = oldScript.textContent;
                    }
                    
                    document.body.appendChild(newScript);
                    oldScript.parentNode.removeChild(oldScript);
                }

                const msg = document.createElement('div');
                msg.className = "text-green-500 p-2 font-bold";
                msg.innerText = "SUCCESS: DOM LOADED";
                logBox.prepend(msg);

            } catch (err) {
                const errorEntry = document.createElement('div');
                errorEntry.className = "text-red-500 p-2";
                errorEntry.innerText = "CORS ERROR: The server blocked direct fetching. You must enable CORS on Scramjet.";
                logBox.prepend(errorEntry);
                console.error("Fetch failed:", err);
            }
        }

        injectWebsite();
    </script>
</body>
</html>
