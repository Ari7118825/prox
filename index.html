<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scramjet API Hunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-green-400 font-mono p-4">

    <div class="max-w-3xl mx-auto">
        <h1 class="text-2xl font-bold mb-4 border-b border-green-800 pb-2">Scramjet Connection Debugger</h1>
        
        <div class="bg-gray-900 p-4 rounded border border-green-900 mb-6">
            <p class="mb-2">Target Host: <span class="text-white">yumiscramjetafc02c3096bf.share.zrok.io</span></p>
            <div id="masterStatus" class="text-lg font-bold">Status: Initializing...</div>
        </div>

        <div class="grid grid-cols-1 gap-4">
            <div class="bg-gray-900 p-4 rounded border border-gray-800">
                <h2 class="text-sm text-gray-500 uppercase mb-3">Endpoint Discovery Logs</h2>
                <div id="logConsole" class="h-64 overflow-y-auto text-xs space-y-1">
                    </div>
            </div>

            <div id="apiResults" class="bg-gray-900 p-4 rounded border border-gray-800 hidden">
                <h2 class="text-sm text-gray-500 uppercase mb-3">Found API Data</h2>
                <pre id="jsonData" class="text-blue-300 text-xs overflow-x-auto"></pre>
            </div>
        </div>
        
        <button onclick="startDiscovery()" class="mt-6 w-full bg-green-700 hover:bg-green-600 text-black font-bold py-3 rounded transition-all">
            RESCAN ENDPOINTS
        </button>
    </div>

    <script>
        const ZROK_HOST = 'https://yumiscramjetafc02c3096bf.share.zrok.io';
        // Common Scramjet STH paths to check
        const PATHS_TO_TEST = [
            '/api/v1',
            '/api/v1/info',
            '/api/v1/health',
            '/api/v1/instance',
            '/api/v1/sequence',
            '/api/v2'
        ];

        const logConsole = document.getElementById('logConsole');
        const masterStatus = document.getElementById('masterStatus');

        function addLog(msg, type = 'info') {
            const div = document.createElement('div');
            const colors = { info: 'text-gray-400', success: 'text-green-400', error: 'text-red-500' };
            div.className = colors[type];
            div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logConsole.appendChild(div);
            logConsole.scrollTop = logConsole.scrollHeight;
        }

        async function startDiscovery() {
            addLog("Starting discovery on " + ZROK_HOST);
            masterStatus.innerText = "Status: Hunting for API...";
            let foundAny = false;

            for (const path of PATHS_TO_TEST) {
                const target = ZROK_HOST + path;
                addLog(`Testing ${path}...`);
                
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);

                    const response = await fetch(target, { 
                        method: 'GET',
                        mode: 'cors', // Crucial for Netlify -> zrok
                        signal: controller.signal 
                    });

                    if (response.ok) {
                        const data = await response.json();
                        addLog(`✅ FOUND API at ${path}!`, 'success');
                        document.getElementById('apiResults').classList.remove('hidden');
                        document.getElementById('jsonData').innerText = JSON.stringify(data, null, 2);
                        masterStatus.innerText = `Status: Connected via ${path}`;
                        foundAny = true;
                        break; 
                    } else {
                        addLog(`❌ Path ${path} returned ${response.status}`, 'error');
                    }
                } catch (err) {
                    addLog(`❌ Path ${path} failed: ${err.message}`, 'error');
                }
            }

            if (!foundAny) {
                masterStatus.innerText = "Status: FAILED - No API Found";
                addLog("Check if Scramjet Hub is running with '--api-port 80' or if zrok is tunneling the correct port.", "error");
            }
        }

        // Auto-start on load
        window.onload = startDiscovery;
    </script>
</body>
</html>
