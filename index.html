<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scramjet with DevTools Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black">

    <div id="scramjet-root" class="w-screen h-screen bg-white overflow-auto"></div>

    <script>
        // 2. Initialize the DevTools Simulator
        eruda.init();
        eruda.show(); // This opens the panel immediately
        console.log("DevTools Simulator Active. Click the 'Network' tab to monitor zrok traffic.");

        const ZROK_URL = 'https://yumiscramjetafc02c3096bf.share.zrok.io';
        const PROXY = 'https://api.codetabs.com/v1/proxy?quest=';

        // 3. Deep Injection Logic
        async function loadWithDevTools() {
            try {
                const response = await fetch(PROXY + encodeURIComponent(ZROK_URL));
                let html = await response.text();

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const proxyUrl = (url) => {
                    if (!url || url.startsWith('data:') || url.startsWith('http')) return url;
                    const absolute = url.startsWith('/') ? ZROK_URL + url : ZROK_URL + '/' + url;
                    return PROXY + encodeURIComponent(absolute);
                };

                // Rewrite all resources so they show up in the simulator's Network tab
                doc.querySelectorAll('link[rel="stylesheet"]').forEach(el => el.href = proxyUrl(el.getAttribute('href')));
                doc.querySelectorAll('script[src]').forEach(el => el.src = proxyUrl(el.getAttribute('src')));
                doc.querySelectorAll('img').forEach(el => el.src = proxyUrl(el.getAttribute('src')));

                const root = document.getElementById('scramjet-root');
                root.innerHTML = doc.body.innerHTML;
                
                // Set base for any background requests
                const base = document.createElement('base');
                base.href = ZROK_URL;
                document.head.appendChild(base);

                // Execute scripts
                doc.querySelectorAll('script').forEach(oldScript => {
                    const newScript = document.createElement('script');
                    if (oldScript.src) {
                        newScript.src = proxyUrl(oldScript.getAttribute('src'));
                    } else {
                        newScript.textContent = oldScript.textContent;
                    }
                    document.body.appendChild(newScript);
                });

            } catch (err) {
                console.error("Failed to inject Scramjet:", err);
            }
        }

        loadWithDevTools();
    </script>
</body>
</html>
